function _derive(base, rules, n, rule_prs, seed) =
    let(
        sd = is_undef(seed) ? rand(0, 1, seed) * 1000 : seed,
        derive = is_undef(rule_prs) ? function(base) _derive1(base, rules) : function(base) _derive1_p(base, rules, rule_prs, sd),
        bs = [
            for(i = 0, b = derive(base); i < n; i = i + 1, b = i != n ? derive(b) : undef)
            b
        ]
    )
    bs[len(bs) - 1];

// It doesn't use recursion to avoid recursion error.