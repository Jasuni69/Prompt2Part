function xyz_to_spherical(x,y,z) =
    y != undef
      ? assert(is_num(x) && is_num(y) && is_num(z), "\nBad arguments.")
        [norm([x,y,z]), atan2(y,x), atan2(norm([x,y]),z)]
      : assert(is_list(x), "\nBad arguments.")
        is_num(x.x)
          ? xyz_to_spherical(x.x, x.y, x.z)
          : [for(p = x) xyz_to_spherical(p.x, p.y, p.z)];


// Function: altaz_to_xyz()
// Synopsis: Convert altitude/azimuth/range to 3D cartesian coordinates. 
// SynTags: Path
// Topics: Coordinates, Points, Paths
// See Also: cylindrical_to_xyz(), xyz_to_spherical(), spherical_to_xyz(), xyz_to_cylindrical(), xyz_to_altaz()
// Usage:
//   pt = altaz_to_xyz(alt, az, r);
//   pt = altaz_to_xyz([ALT,AZ,R]);
//   pts = altaz_to_xyz([[ALT,AZ,R], [ALT,AZ,R], ...]);
// Description:
//   Convert altitude/azimuth/range coordinates to 3D cartesian coordinates.
//   Called with three arguments, converts the `alt`, `az`, and 'r' 3D altitude-azimuth coordinate into an `[X,Y,Z]` cartesian coordinate.
//   Called with one `[ALTITUDE,AZIMUTH,RANGE]` vector argument, converts the 3D alt-az coordinate into an `[X,Y,Z]` cartesian coordinate.
//   Called with a list of `[ALTITUDE,AZIMUTH,RANGE]` vector arguments, converts each 3D alt-az coordinate into `[X,Y,Z]` cartesian coordinates.
//   Altitude is the angle above the XY plane, Azimuth is degrees clockwise of Y+ on the XY plane, and Range is the distance from the origin.
// Arguments:
//   alt = altitude angle in degrees above the XY plane.
//   az = azimuth angle in degrees clockwise of Y+ on the XY plane.
//   r = distance from origin.
// Example:
//   xyz = altaz_to_xyz(20,30,40);
//   xyz = altaz_to_xyz([40,60,50]);