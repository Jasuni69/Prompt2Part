function altaz_to_xyz(alt,az,r) =
    az != undef
      ? assert(is_num(alt) && is_num(az) && is_num(r), "\nBad arguments.")
        r*[cos(90-az)*cos(alt), sin(90-az)*cos(alt), sin(alt)]
      : assert(is_list(alt), "\nBad arguments.")
        is_num(alt.x)
          ? altaz_to_xyz(alt.x, alt.y, alt.z)
          : [for(p = alt) altaz_to_xyz(p.x, p.y, p.z)];



// Function: xyz_to_altaz()
// Synopsis: Convert 3D cartesian coordinates to [altitude,azimuth,range]. 
// Topics: Coordinates, Points, Paths
// See Also: cylindrical_to_xyz(), xyz_to_spherical(), spherical_to_xyz(), xyz_to_cylindrical(), altaz_to_xyz()
// Usage:
//   alt_az_r = xyz_to_altaz(x,y,z);
//   alt_az_r = xyz_to_altaz([X,Y,Z]);
//   alt_az_rs = xyz_to_altaz([[X,Y,Z], [X,Y,Z], ...]);
// Description:
//   Converts 3D cartesian coordinates to altitude/azimuth/range coordinates.
//   Called with three arguments, converts the `x`, `y`, and `z` 3D cartesian coordinate into an `[ALTITUDE,AZIMUTH,RANGE]` coordinate.
//   Called with one `[X,Y,Z]` vector argument, converts the 3D cartesian coordinate into a `[ALTITUDE,AZIMUTH,RANGE]` coordinate.
//   Called with a list of `[X,Y,Z]` vector arguments, converts each 3D cartesian coordinate into `[ALTITUDE,AZIMUTH,RANGE]` coordinates.
//   Altitude is the angle above the XY plane, Azimuth is degrees clockwise of Y+ on the XY plane, and Range is the distance from the origin.
// Arguments:
//   x = X coordinate.
//   y = Y coordinate.
//   z = Z coordinate.
// Example:
//   aa = xyz_to_altaz(20,30,40);
//   aa = xyz_to_altaz([40,50,70]);