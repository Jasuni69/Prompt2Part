module poly_cylinder(r, h, center = false, sides = undef, chamfer = false, twist = 0) {//! Make a cylinder adjusted to print the correct size
    if(twist) {
        slices = ceil(h / layer_height);
        twists = min(twist + 1, slices);
        sides = sides(r, sides);
        rot = 360 / sides / twists * (twists < slices ? (1 + 1 / slices) : 1);
        if(center)
            for(side = [0, 1])
                mirror([0, 0, side])
                    poly_cylinder(r = r, h = h / 2, sides = sides, twist = twist);
        else
            render(convexity = 5)
                for(i = [0 : slices - 1])
                    translate_z(i * layer_height - eps)
                        rotate(rot * i)
                            poly_cylinder(r = r, h = layer_height + 2 * eps, sides = sides);
    }
    else
        extrude_if(h, center)
            poly_circle(r, sides);

    if(h && chamfer)
        poly_cylinder(r + layer_height, center ? layer_height * 2 : layer_height, center, sides = sides(r, sides));
}