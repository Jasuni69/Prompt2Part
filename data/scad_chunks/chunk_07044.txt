module test_subdivide_path(){
     assert(approx(subdivide_path(square([2,2],center=true), 12), [[1, -1], [1/3, -1], [-1/3, -1], [-1, -1], [-1, -1/3], [-1, 1/3], [-1, 1], [-1/3, 1], [1/3, 1], [1, 1], [1, 1/3], [1, -1/3]]));
     assert_equal(subdivide_path(square([8,2],center=true), 12), [[4, -1], [2, -1], [0, -1], [-2, -1], [-4, -1], [-4, 0], [-4, 1], [-2, 1], [0, 1], [2, 1], [4, 1], [4, 0]]);
    assert_approx(subdivide_path(square([8,2],center=true), 12, method="segment"), [[4, -1], [4/3, -1], [-4/3, -1], [-4, -1], [-4, -1/3], [-4, 1/3], [-4, 1], [-4/3, 1], [4/3, 1], [4, 1], [4, 1/3], [4, -1/3]]);
    assert_approx(subdivide_path(square([2,2],center=true), 17, closed=false), [[1, -1], [0.6, -1], [0.2, -1], [-0.2, -1], [-0.6, -1], [-1, -1], [-1, -2/3], [-1, -1/3], [-1, 0], [-1, 1/3], [-1, 2/3], [-1, 1], [-0.6, 1], [-0.2, 1], [0.2, 1], [0.6, 1], [1, 1]]);
    assert_approx(subdivide_path(hexagon(side=2), [2,3,4,5,6,7], method="segment"),
                [[2, 0], [1.5, -0.866025403784], [1, -1.73205080757],
                [0.333333333333, -1.73205080757], [-0.333333333333,
                -1.73205080757], [-1, -1.73205080757], [-1.25,
                -1.29903810568], [-1.5, -0.866025403784], [-1.75,
                -0.433012701892], [-2, 0], [-1.8, 0.346410161514],
                [-1.6, 0.692820323028], [-1.4, 1.03923048454], [-1.2,
                1.38564064606], [-1, 1.73205080757], [-0.666666666667,
                1.73205080757], [-0.333333333333, 1.73205080757], [0,
                1.73205080757], [0.333333333333, 1.73205080757],
                [0.666666666667, 1.73205080757], [1, 1.73205080757],
                [1.14285714286, 1.48461497792], [1.28571428571,
                1.23717914826], [1.42857142857, 0.989743318611],
                [1.57142857143, 0.742307488958], [1.71428571429,
                0.494871659305], [1.85714285714, 0.247435829653]]);
    assert_approx(subdivide_path(pentagon(side=2), [3,4,3,4], method="segment", closed=false),
           [[1.7013016167, 0], [1.30944478184, -0.539344662917],
           [0.917587946981, -1.07868932583], [0.525731112119,
           -1.61803398875], [0.0502028539716, -1.46352549156],
           [-0.425325404176, -1.30901699437], [-0.900853662324,
           -1.15450849719], [-1.37638192047, -1], [-1.37638192047,
           -0.333333333333], [-1.37638192047, 0.333333333333],
           [-1.37638192047, 1], [-0.900853662324, 1.15450849719],
           [-0.425325404176, 1.30901699437], [0.0502028539716,
           1.46352549156], [0.525731112119, 1.61803398875]]);
    assert_approx(subdivide_path(pentagon(side=2), 17),
                  [[1.7013016167, 0], [1.30944478184,
                  -0.539344662917], [0.917587946981, -1.07868932583],
                  [0.525731112119, -1.61803398875], [0.0502028539716,
                  -1.46352549156], [-0.425325404176, -1.30901699437],
                  [-0.900853662324, -1.15450849719], [-1.37638192047,
                  -1], [-1.37638192047, -0.333333333333],
                  [-1.37638192047, 0.333333333333], [-1.37638192047,
                  1], [-0.900853662324, 1.15450849719],
                  [-0.425325404176, 1.30901699437], [0.0502028539716,
                  1.46352549156], [0.525731112119, 1.61803398875],
                  [0.917587946981, 1.07868932583], [1.30944478184,
                  0.539344662917]]);
    assert_approx(subdivide_path(pentagon(side=2), 17, exact=false),
                  [[1.7013016167, 0], [1.30944478184,
                  -0.539344662917], [0.917587946981, -1.07868932583],
                  [0.525731112119, -1.61803398875], [-0.108306565411,
                  -1.41202265917], [-0.742344242941, -1.20601132958],
                  [-1.37638192047, -1], [-1.37638192047,
                  -0.333333333333], [-1.37638192047, 0.333333333333],
                  [-1.37638192047, 1], [-0.742344242941,
                  1.20601132958], [-0.108306565411, 1.41202265917],
                  [0.525731112119, 1.61803398875], [0.917587946981,
                  1.07868932583], [1.30944478184, 0.539344662917]]);
    assert_approx(subdivide_path(pentagon(side=2), 18, exact=false),
                    [[1.7013016167, 0], [1.40740899056,
                    -0.404508497187], [1.11351636441,
                    -0.809016994375], [0.819623738265,
                    -1.21352549156], [0.525731112119, -1.61803398875],
                    [0.0502028539716, -1.46352549156],
                    [-0.425325404176, -1.30901699437],
                    [-0.900853662324, -1.15450849719],
                    [-1.37638192047, -1], [-1.37638192047, -0.5],
                    [-1.37638192047, 0], [-1.37638192047, 0.5],
                    [-1.37638192047, 1], [-0.900853662324,
                    1.15450849719], [-0.425325404176, 1.30901699437],
                    [0.0502028539716, 1.46352549156], [0.525731112119,
                    1.61803398875], [0.819623738265, 1.21352549156],
                    [1.11351636441, 0.809016994375], [1.40740899056,
                    0.404508497187]]);
    assert_approx(subdivide_path([[0,0,0],[2,0,1],[2,3,2]], 12),
          [[0, 0, 0], [2/3, 0, 1/3], [4/3, 0, 2/3], [2, 0, 1], [2, 0.75, 1.25], [2, 1.5, 1.5], [2, 2.25, 1.75], [2, 3, 2], [1.6, 2.4, 1.6], [1.2, 1.8, 1.2], [0.8, 1.2, 0.8], [0.4, 0.6, 0.4]]);

   path = pentagon(d=100);
   spath = subdivide_path(path, maxlen=10, closed=true);
   assert_approx(spath,
         [[50, 0], [44.2418082865, -7.92547096913], [38.4836165729,
         -15.8509419383], [32.7254248594, -23.7764129074], [26.9672331458,
         -31.7018838765], [21.2090414323, -39.6273548456], [15.4508497187,
         -47.5528258148], [6.1338998125, -44.5255652814], [-3.18305009375,
         -41.498304748], [-12.5, -38.4710442147], [-21.8169499062,
         -35.4437836813], [-31.1338998125, -32.416523148], [-40.4508497187,
         -29.3892626146], [-40.4508497187, -19.5928417431], [-40.4508497187,
         -9.79642087154], [-40.4508497187, 0], [-40.4508497187, 9.79642087154],
         [-40.4508497187, 19.5928417431], [-40.4508497187, 29.3892626146],
         [-31.1338998125, 32.416523148], [-21.8169499062, 35.4437836813],
         [-12.5, 38.4710442147], [-3.18305009375, 41.498304748], [6.1338998125,
         44.5255652814], [15.4508497187, 47.5528258148], [21.2090414323,
         39.6273548456], [26.9672331458, 31.7018838765], [32.7254248594,
         23.7764129074], [38.4836165729, 15.8509419383], [44.2418082865,
         7.92547096913]]);
}
test_subdivide_path();