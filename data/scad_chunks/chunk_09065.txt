function carve_top(x, y, z, cells) = 
    let(cell = cells[z][y][x])
    update(
        cells, 
        z_y_x_wall(cell) ? [x, y, z, Z_X_WALL, VISITED] :
        z_y_wall(cell)   ? [x, y, z, Z_WALL, VISITED] :
        y_x_wall(cell)   ? [x, y, z, X_WALL, VISITED] : [x, y, z, NO_WALL, VISITED]
    );

// go up and carve the up wall